<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSmV-ladv2Gu74q_70lrv375kPXcn8v6hHTAv4iZdJ9mozkscUmNU9zaFRA3zI1ebhcm25sCP4TiUhD/pub?output=csv";

async function buscarCertificados() {
  const dni = document.getElementById("dni").value.trim();
  const resultados = document.getElementById("resultados");
  resultados.innerHTML = "";

  if (!dni) {
    resultados.innerHTML = "<p>Ingrese un DNI vÃ¡lido.</p>";
    return;
  }

  try {
    const res = await fetch(CSV_URL + "&t=" + Date.now());
    const text = await res.text();

    const filas = text.split(/\r?\n/).slice(1);
    let encontrados = 0;

    filas.forEach(fila => {
      if (!fila) return;
      const cols = fila.split(",");

      if (cols[0] === dni) {
        encontrados++;

        resultados.innerHTML += `
          <div class="cert">
            <div class="cert-title">âœ” ${cols[2]} â€“ ${cols[3]}</div>
            <div class="cert-code">CÃ³digo: ${cols[1]}</div>
            <div>Horas: ${cols[6]} | Modalidad: ${cols[7]}</div>
            <div>Fecha: ${cols[8]}</div>
            <a href="${cols[10]}" target="_blank">ðŸ“„ Descargar certificado</a>
          </div>
        `;
      }
    });

    if (encontrados === 0) {
      resultados.innerHTML = "<p>No se encontraron certificados asociados al DNI ingresado.</p>";
    }

  } catch (e) {
    resultados.innerHTML = "<p>Error al cargar certificados.</p>";
    console.error(e);
  }
}
</script>
